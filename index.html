<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Private Chat</title>
    <script src="https://cdn.jsdelivr.net/npm/@stomp/stompjs@7.0.0/bundles/stomp.umd.min.js"></script>

    <style>
      body {
        background: linear-gradient(135deg, #4b6cb7, #182848);
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        color: #fff;
        margin: 0;
        padding: 0;
      }
      
      .layout {
        display: flex;
        width: 100%;
        height: 100vh;
      }

      /* LEFT PANEL â€“ USER LIST */
      .user-list {
        width: 230px;
        background: #ffffff;
        color: #333;
        border-right: 1px solid #ddd;
        overflow-y: auto;
        padding: 10px;
      }

      .user-card {
        background: #f2f4f8;
        padding: 12px;
        margin-bottom: 8px;
        border-radius: 8px;
        cursor: pointer;
        transition: 0.2s;
        font-weight: 500;
      }

      .user-card:hover {
        background: #dde3f0;
      }

      .user-card.active {
        background: #4b6cb7;
        color: white;
      }

      /* RIGHT PANEL â€“ CHAT */
      .chat-container {
        flex: 1;
        background: #f7f9fc;
        color: #333;
        display: flex;
        flex-direction: column;
      }

      .header {
        background: #182848;
        color: #fff;
        padding: 15px;
        text-align: center;
        font-size: 20px;
        font-weight: 600;
      }

      .chat-box {
        flex: 1;
        padding: 15px;
        overflow-y: auto;
        background: #f0f3fa;
        display: flex;
        flex-direction: column;
        gap: 10px;
      }

      .message {
        padding: 10px 14px;
        border-radius: 12px;
        max-width: 70%;
        line-height: 1.4;
      }

      .you {
        background: #4b6cb7;
        color: #fff;
        align-self: flex-end;
      }

      .other {
        background: #dce3f3;
        align-self: flex-start;
      }

      .message-input {
        display: flex;
        border-top: 1px solid #ddd;
        background: #fff;
      }

      .message-input input {
        flex: 1;
        border: none;
        padding: 12px;
        outline: none;
      }

      .message-input button {
        background: #4b6cb7;
        color: white;
        border: none;
        padding: 0 20px;
        cursor: pointer;
      }
    </style>
  </head>

  <body>
    <div class="layout">
      <!-- LEFT: USER LIST -->
      <div class="user-list" id="user-list"></div>

      <!-- RIGHT: CHAT -->
      <div class="chat-container">
        <div class="header" id="header">Private Chat</div>

        <div id="chatBox" class="chat-box"></div>

        <div class="message-input">
          <input type="text" id="message" placeholder="Type message..." />
          <button onclick="sendMessage()">Send</button>
        </div>
      </div>
    </div>

    <script src="./index.js"></script>

    <!-- <script>
    let stompClient = null;
    let username = null;
    let currentReceiver = null;

    // ðŸš€ STEP 1 â€” Fetch session user on load
    window.addEventListener("DOMContentLoaded", () => {
        fetch("http://localhost:8080/currentUser")
            .then(res => res.json())
            .then(user => {
                if (user && user.name) {
                    // Store user in localStorage
                    localStorage.setItem("loggedInUser", JSON.stringify(user));
                    username = user.name;

                    // Auto connect to chat
                    connect();
                } else {
                    // Session expired â€” redirect
                    window.location.href = "/login";
                }
            })
            .catch(err => {
                console.error("Error fetching session user:", err);
                window.location.href = "/login";
            });
    });

    // ðŸš€ STEP 2 â€” Connect user to chat automatically
    function connect() {
        const storedUser = JSON.parse(localStorage.getItem("loggedInUser"));
        if (!storedUser) {
            return window.location.href = "/login";
        }

        username = storedUser.name;

        stompClient = new StompJs.Client({
            brokerURL: "ws://localhost:8080/chat",

            onConnect: () => {
                showSystemMessage("âœ… Connected as " + username);
                document.getElementById("header").innerText = "Chat - " + username;

                stompClient.subscribe("/user/" + username + "/private", (message) => {
                    const msg = JSON.parse(message.body);
                    showMessage(msg.sender, msg.content, "other");
                });

                getAlumni();
            }
        });

        stompClient.activate();
    }

    // ðŸš€ STEP 3 â€” Send message
    function sendMessage() {
        const text = document.getElementById("message").value.trim();
        if (!currentReceiver) return alert("Select a user first!");
        if (!text) return;

        const msg = {
            sender: username,
            receiver: currentReceiver,
            content: text
        };

        stompClient.publish({
            destination: "/app/private-message",
            body: JSON.stringify(msg)
        });

        showMessage("You", text, "you");
        document.getElementById("message").value = "";
    }

    // ðŸš€ STEP 4 â€” Display message in chat
    function showMessage(sender, text, type) {
        const div = document.createElement("div");
        div.classList.add("message", type);
        div.textContent = sender + ": " + text;
        document.getElementById("chatBox").appendChild(div);
        div.scrollIntoView({ behavior: "smooth" });
    }

    function showSystemMessage(text) {
        const div = document.createElement("div");
        div.style.textAlign = "center";
        div.style.color = "#666";
        div.textContent = text;
        document.getElementById("chatBox").appendChild(div);
    }

    // ðŸš€ STEP 5 â€” Load all alumni users
    function getAlumni() {
        fetch("http://localhost:8080/getAllAlumni")
            .then(res => res.json())
            .then(data => {
                const list = document.getElementById("user-list");
                list.innerHTML = "";

                //all alumni data
                console.log(data);
                data.forEach(a => {
                    if (a.name === username) return; // don't show yourself

                    const card = document.createElement("div");
                    card.classList.add("user-card");
                    card.textContent = a.name;
                    card.dataset.name = a.name;

                    card.onclick = () => {
                        document.querySelectorAll(".user-card")
                            .forEach(c => c.classList.remove("active"));
                        card.classList.add("active");

                        currentReceiver = a.name;
                        document.getElementById("header").innerText = "Chat with " + currentReceiver;
                        showSystemMessage("Chatting with: " + a.name);
                    };

                    list.appendChild(card);
                });
            });
    }
</script> -->
  </body>
</html>
